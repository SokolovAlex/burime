{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect, useMemo } from 'react';\nimport { BurimeStep, StepDuration } from '../../../models/burime';\nimport { RedTitle } from '../../atoms/Title/Title';\nimport { GameContainer, CurrentStep, StepsWrapper, HiddenRow, GameDetails, GameProgress, GameResult, StepTime, BottomActions, WarningMessage } from './styled';\nimport { BurimeName } from '../../atoms/styled';\nimport { MyStepEnter } from './MyStepEnter/MyStepEnter';\nimport { useSocket } from '../../../services/socket';\nimport { newStep, createStep, finishBurime, closeBurime } from '../../../constants/socketEvents';\nimport { Book } from '@styled-icons/octicons/Book';\nimport { Timer } from '@styled-icons/material/Timer';\nimport { useCheckFinishedBurime, goToBurime } from '../../../services/api/burime';\nimport { Author } from '../../atoms/Author/Author';\nimport { BurimeTitle } from '../../atoms/styled';\nimport { Button, ButtonType } from '../../atoms/Button/Button';\n\nvar createActiveStep = function createActiveStep(burime, burimeSteps, user, opponent) {\n  var step = new BurimeStep();\n  step.order = burimeSteps.length + 1;\n  step.burime = burime;\n  var lastStep = burimeSteps[burimeSteps.length - 1];\n\n  if (lastStep) {\n    step.user = lastStep.user.email === user.email ? opponent : user;\n  } else {\n    step.user = burime.user1;\n  }\n\n  return step;\n};\n\nvar BurimeGame = function BurimeGame(_ref) {\n  var burime = _ref.burime,\n      user = _ref.user;\n  var theme = burime.theme,\n      name = burime.name,\n      user1 = burime.user1,\n      user2 = burime.user2,\n      stepDuration = burime.stepDuration,\n      stepsAmount = burime.stepsAmount,\n      id = burime.id,\n      _burime$steps = burime.steps,\n      steps = _burime$steps === void 0 ? [] : _burime$steps;\n  var opponent = useMemo(function () {\n    return user1.email === user.email ? user2 : user1;\n  }, []);\n  var socket = useSocket();\n\n  var _useState = useState(steps),\n      burimeSteps = _useState[0],\n      setBurimeSteps = _useState[1];\n\n  var _useState2 = useState(createActiveStep(burime, burimeSteps, user, opponent)),\n      activeStep = _useState2[0],\n      setActiveStep = _useState2[1];\n\n  var _useState3 = useState(false),\n      confrim = _useState3[0],\n      setConfirm = _useState3[1];\n\n  useCheckFinishedBurime(id);\n  useEffect(function () {\n    var onNewStep = function onNewStep(step) {\n      var newSteps = [].concat(_toConsumableArray(burimeSteps), [step]);\n      setBurimeSteps(newSteps);\n      var newActiveStep = createActiveStep(burime, newSteps, user, opponent);\n      setActiveStep(newActiveStep);\n    };\n\n    var onFinish = function onFinish() {\n      return goToBurime(id);\n    };\n\n    socket.on(newStep, onNewStep);\n    socket.on(finishBurime, onFinish);\n    return function () {\n      socket.off(newStep, onNewStep);\n      socket.off(finishBurime, onFinish);\n    };\n  }, [burimeSteps]);\n  var onStepConfirm = useCallback(function (step) {\n    return socket.emit(createStep, step);\n  }, []);\n  var onCloseBurime = useCallback(function () {\n    return setConfirm(true);\n  }, []);\n  var onConfirm = useCallback(function () {\n    return socket.emit(closeBurime, id);\n  }, []);\n  var onCancel = useCallback(function () {\n    return setConfirm(false);\n  }, []);\n  return React.createElement(React.Fragment, null, React.createElement(BurimeName, null, name), React.createElement(BurimeTitle, {\n    center: true\n  }, theme), React.createElement(GameContainer, null, React.createElement(CurrentStep, null, activeStep.user.email === user.email ? React.createElement(MyStepEnter, {\n    step: activeStep,\n    onConfirm: onStepConfirm\n  }) : React.createElement(RedTitle, null, \"\\u0416\\u0434\\u0435\\u043C, \\u0447\\u0442\\u043E \\u043D\\u0430\\u043F\\u0438\\u0448\\u0435\\u0442 \", opponent.name)), React.createElement(StepsWrapper, null, React.createElement(GameDetails, null, React.createElement(GameProgress, null, React.createElement(Book, {\n    size: 32\n  }), React.createElement(\"div\", null, burimeSteps.length * 2, \"/\", stepsAmount * 2)), React.createElement(StepTime, null, React.createElement(Timer, {\n    size: 32\n  }), React.createElement(\"div\", null, stepDuration !== StepDuration.None ? '-' : 0))), React.createElement(GameResult, null, burimeSteps.map(function (step, i) {\n    return React.createElement(React.Fragment, {\n      key: i\n    }, React.createElement(Author, {\n      isMine: step.user.email === user.email,\n      name: step.user.name\n    }), React.createElement(HiddenRow, null), i !== burimeSteps.length - 1 ? React.createElement(HiddenRow, null) : React.createElement(\"div\", null, step.row2));\n  })))), React.createElement(BottomActions, null, confrim ? React.createElement(React.Fragment, null, React.createElement(WarningMessage, null, \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\"), React.createElement(Button, {\n    onClick: onConfirm,\n    size: \"sm\",\n    type: ButtonType.danger\n  }, \"\\u0414\\u0430\"), React.createElement(Button, {\n    onClick: onCancel,\n    size: \"sm\",\n    type: ButtonType.white\n  }, \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\")) : React.createElement(React.Fragment, null, React.createElement(Button, {\n    onClick: onCloseBurime,\n    size: \"sm\",\n    type: ButtonType.danger\n  }, \"\\u041F\\u0440\\u0435\\u0440\\u0432\\u0430\\u0442\\u044C \\u044D\\u0442\\u043E \\u0431\\u0443\\u0440\\u0438\\u043C\\u0435\"))));\n};\n\nexport default BurimeGame;","map":null,"metadata":{},"sourceType":"module"}