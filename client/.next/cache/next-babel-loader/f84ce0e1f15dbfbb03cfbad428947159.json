{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\alexs\\\\Desktop\\\\\\u0410\\u043B\\u0435\\u043A\\u0441\\u0435\\u0439\\\\code\\\\burime\\\\client\\\\components\\\\organizms\\\\BurimeCalls\\\\BurimeCalls.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { useSocket } from \"../../../services/socket\";\nimport { useUser } from \"../../../services/contexts/auth\";\nimport { ButtonWrapper } from './styled';\nimport { Title } from \"../../atoms/Title/Title\";\nimport { Button } from \"../../atoms/Button/Button\";\nimport { getCalls, goToGame, useActiveBurime } from \"../../../services/api/burime\";\nimport { BurimeEdit } from \"../../molecules/BurimeCard/BurimeEdit\";\nimport { BurimeModel } from \"../../../models/burime\";\nimport { BurimeCallList } from \"../../molecules/BurimeCard/BurimeCallList\";\nimport { Spinner } from '../../atoms/Spinner/Spinner';\nimport { createBurime, newBurime, deleteBurime, deletedBurime, acceptBurime, acceptedBurime } from \"../../../constants/socketEvents\";\nexport var BurimeCalls = function BurimeCalls() {\n  var user = useUser();\n\n  if (!user) {\n    return null;\n  }\n\n  var socket = useSocket();\n  useActiveBurime();\n\n  var _useState = useState(false),\n      haveCall = _useState[0],\n      setHaveCall = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(null),\n      _ = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState([]),\n      burimes = _useState4[0],\n      setBurimes = _useState4[1];\n\n  var _useState5 = useState(),\n      edittedBurime = _useState5[0],\n      setEdittedBurime = _useState5[1];\n\n  useEffect(function () {\n    getCalls().then(function (data) {\n      var burimes = data.burimes;\n      var hasMine = burimes.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setBurimes(burimes);\n      setHaveCall(hasMine);\n    })[\"catch\"](function (err) {\n      return setError(err);\n    })[\"finally\"](function () {\n      return setLoading(false);\n    });\n  }, []);\n  useEffect(function () {\n    var onNewBurime = function onNewBurime(burime) {\n      var newBurimeList = [burime].concat(_toConsumableArray(burimes));\n      var hasMine = newBurimeList.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setHaveCall(hasMine);\n      setBurimes(newBurimeList);\n    };\n\n    var removeBurimeById = function removeBurimeById(burimeId) {\n      var newBuremiList = burimes.filter(function (burime) {\n        return burime.id !== burimeId;\n      });\n      var hasMine = newBuremiList.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setBurimes(newBuremiList);\n      setHaveCall(hasMine);\n    };\n\n    var onAcceptBurime = function onAcceptBurime(burime) {\n      removeBurimeById(burime.id);\n\n      if (user.email === burime.user1.email || user.email === burime.user2.email) {\n        goToGame(burime.id);\n      }\n    };\n\n    socket.on(newBurime, onNewBurime);\n    socket.on(acceptedBurime, onAcceptBurime);\n    socket.on(deletedBurime, removeBurimeById);\n    return function () {\n      socket.off(deletedBurime, removeBurimeById);\n      socket.off(acceptedBurime, onAcceptBurime);\n      socket.off(newBurime, onNewBurime);\n    };\n  }, [burimes]);\n  var changeMode = useCallback(function () {\n    return setEdittedBurime(edittedBurime ? undefined : new BurimeModel());\n  }, [edittedBurime]);\n  var onSave = useCallback(function (burime) {\n    socket.emit(createBurime, burime);\n    changeMode();\n  }, [changeMode]);\n  var onReject = useCallback(function (burime) {\n    return socket.emit(deleteBurime, burime);\n  }, []);\n  var onAccept = useCallback(function (burime) {\n    burime.user2 = user;\n    socket.emit(acceptBurime, burime);\n  }, []);\n  return React.createElement(React.Fragment, null, !edittedBurime && React.createElement(Title, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, \"\\u041F\\u0440\\u0438\\u0433\\u043B\\u0430\\u0448\\u0435\\u043D\\u0438\\u044F\"), !(edittedBurime || haveCall) && React.createElement(ButtonWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, React.createElement(Button, {\n    width: 300,\n    onClick: changeMode,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }, \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0438\\u0433\\u0440\\u0443\")), !loading ? React.createElement(React.Fragment, null, edittedBurime ? React.createElement(BurimeEdit, {\n    burime: edittedBurime,\n    onSave: onSave,\n    onCancel: changeMode,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }) : React.createElement(BurimeCallList, {\n    haveCall: haveCall,\n    onAccept: onAccept,\n    onReject: onReject,\n    burimes: burimes,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  })) : React.createElement(Spinner, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }));\n};","map":{"version":3,"sources":["C:/Users/alexs/Desktop/Алексей/code/burime/client/components/organizms/BurimeCalls/BurimeCalls.tsx"],"names":["React","useState","useCallback","useEffect","useSocket","useUser","ButtonWrapper","Title","Button","getCalls","goToGame","useActiveBurime","BurimeEdit","BurimeModel","BurimeCallList","Spinner","createBurime","newBurime","deleteBurime","deletedBurime","acceptBurime","acceptedBurime","BurimeCalls","user","socket","haveCall","setHaveCall","loading","setLoading","_","setError","burimes","setBurimes","edittedBurime","setEdittedBurime","then","data","hasMine","some","burime","user1","email","err","onNewBurime","newBurimeList","removeBurimeById","burimeId","newBuremiList","filter","id","onAcceptBurime","user2","on","off","changeMode","undefined","onSave","emit","onReject","onAccept"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport { useSocket } from \"../../../services/socket\";\nimport { useUser } from \"../../../services/contexts/auth\";\nimport { ButtonWrapper } from './styled';\nimport { Title } from \"../../atoms/Title/Title\";\nimport { Button } from \"../../atoms/Button/Button\";\nimport { getCalls, goToGame, useActiveBurime } from \"../../../services/api/burime\";\nimport { BurimeEdit } from \"../../molecules/BurimeCard/BurimeEdit\";\nimport { BurimeModel } from \"../../../models/burime\";\nimport { BurimeCallList } from \"../../molecules/BurimeCard/BurimeCallList\";\nimport { Spinner } from '../../atoms/Spinner/Spinner';\nimport { createBurime, newBurime, deleteBurime, deletedBurime, acceptBurime, acceptedBurime } from \"../../../constants/socketEvents\";\n\nexport const BurimeCalls = () => {\n    const user = useUser();\n    if (!user) { \n        return null;\n    }  \n    const socket = useSocket();\n    useActiveBurime();\n    const [haveCall, setHaveCall] = useState(false);\n    const [loading, setLoading] = useState(true);\n    const [_, setError] = useState(null);\n    const [burimes, setBurimes] = useState<BurimeModel[]>([]);\n    const [ edittedBurime, setEdittedBurime ] = useState<BurimeModel>();\n\n    useEffect(() => {\n        getCalls()\n            .then(data => {\n                const burimes = data.burimes;\n                const hasMine = burimes.some(burime => burime.user1.email === user.email);\n                setBurimes(burimes);\n                setHaveCall(hasMine);\n            })\n            .catch(err => setError(err))\n            .finally(() => setLoading(false));\n    }, []);\n\n    useEffect(() => {\n        const onNewBurime = burime => {\n            const newBurimeList = [burime, ...burimes];\n            const hasMine = newBurimeList.some(burime => burime.user1.email === user.email);\n            setHaveCall(hasMine);\n            setBurimes(newBurimeList);\n        };\n        const removeBurimeById = burimeId => {\n            const newBuremiList = burimes.filter(burime => burime.id !== burimeId);\n            const hasMine = newBuremiList.some(burime => burime.user1.email === user.email);\n            setBurimes(newBuremiList);\n            setHaveCall(hasMine);\n        }\n        const onAcceptBurime = burime => {\n            removeBurimeById(burime.id);\n            if (user.email === burime.user1.email || user.email === burime.user2.email) {\n                goToGame(burime.id);\n            }\n        };\n        socket.on(newBurime, onNewBurime);\n        socket.on(acceptedBurime, onAcceptBurime);\n        socket.on(deletedBurime, removeBurimeById);\n        return () => {\n            socket.off(deletedBurime, removeBurimeById);\n            socket.off(acceptedBurime, onAcceptBurime);\n            socket.off(newBurime, onNewBurime);\n        };\n    }, [burimes]);\n\n    const changeMode = useCallback(() =>  setEdittedBurime(edittedBurime ? undefined : new BurimeModel()), [edittedBurime]);\n    const onSave = useCallback(burime => { \n        socket.emit(createBurime, burime);\n        changeMode();\n    }, [changeMode]);\n    const onReject = useCallback(burime => socket.emit(deleteBurime, burime), []);\n    const onAccept = useCallback(burime => {\n        burime.user2 = user;\n        socket.emit(acceptBurime, burime);\n    }, []);\n\n    return <>\n        { !edittedBurime &&\n            <Title>Приглашения</Title>\n        }\n        { !(edittedBurime || haveCall) && (\n                <ButtonWrapper>\n                    <Button width={300} onClick={changeMode}>Создать игру</Button>\n                </ButtonWrapper>\n            )\n        }\n        { !loading\n            ? (\n                <>\n                    { edittedBurime\n                        ? <BurimeEdit \n                            burime={edittedBurime}\n                            onSave={onSave}\n                            onCancel={changeMode}></BurimeEdit>\n                        : <BurimeCallList\n                            haveCall={haveCall}\n                            onAccept={onAccept}\n                            onReject={onReject}\n                            burimes={burimes}></BurimeCallList>\n                    }\n                </>\n            )\n            : <Spinner/>\n        }\n    </>\n}"]},"metadata":{},"sourceType":"module"}