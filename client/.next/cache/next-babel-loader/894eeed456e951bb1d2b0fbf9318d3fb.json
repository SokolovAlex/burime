{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { useSocket } from \"../../../services/socket\";\nimport { useUser } from \"../../../services/contexts/auth\";\nimport { ButtonWrapper } from './styled';\nimport { Title } from \"../../atoms/Title/Title\";\nimport { Button } from \"../../atoms/Button/Button\";\nimport { getCalls, goToGame, useActiveBurime } from \"../../../services/api/burime\";\nimport { BurimeEdit } from \"../../molecules/BurimeCard/BurimeEdit\";\nimport { BurimeModel } from \"../../../models/burime\";\nimport { BurimeCallList } from \"../../molecules/BurimeCard/BurimeCallList\";\nimport { Spinner } from '../../atoms/Spinner/Spinner';\nimport { createBurime, newBurime, deleteBurime, deletedBurime, acceptBurime, acceptedBurime } from \"../../../constants/socketEvents\";\nexport var BurimeCalls = function BurimeCalls() {\n  var user = useUser();\n\n  if (!user) {\n    return null;\n  }\n\n  var socket = useSocket();\n  useActiveBurime();\n\n  var _useState = useState(false),\n      haveCall = _useState[0],\n      setHaveCall = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(null),\n      _ = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState([]),\n      burimes = _useState4[0],\n      setBurimes = _useState4[1];\n\n  var _useState5 = useState(),\n      edittedBurime = _useState5[0],\n      setEdittedBurime = _useState5[1];\n\n  useEffect(function () {\n    getCalls().then(function (data) {\n      var burimes = data.burimes;\n      var hasMine = burimes.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setBurimes(burimes);\n      setHaveCall(hasMine);\n    })[\"catch\"](function (err) {\n      return setError(err);\n    })[\"finally\"](function () {\n      return setLoading(false);\n    });\n  }, []);\n  useEffect(function () {\n    var onNewBurime = function onNewBurime(burime) {\n      var newBurimeList = [burime].concat(_toConsumableArray(burimes));\n      var hasMine = newBurimeList.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setHaveCall(hasMine);\n      setBurimes(newBurimeList);\n    };\n\n    var removeBurimeById = function removeBurimeById(burimeId) {\n      var newBuremiList = burimes.filter(function (burime) {\n        return burime.id !== burimeId;\n      });\n      var hasMine = newBuremiList.some(function (burime) {\n        return burime.user1.email === user.email;\n      });\n      setBurimes(newBuremiList);\n      setHaveCall(hasMine);\n    };\n\n    var onAcceptBurime = function onAcceptBurime(burime) {\n      removeBurimeById(burime.id);\n\n      if (user.email === burime.user1.email || user.email === burime.user2.email) {\n        goToGame(burime.id);\n      }\n    };\n\n    socket.on(newBurime, onNewBurime);\n    socket.on(acceptedBurime, onAcceptBurime);\n    socket.on(deletedBurime, removeBurimeById);\n    return function () {\n      socket.off(deletedBurime, removeBurimeById);\n      socket.off(acceptedBurime, onAcceptBurime);\n      socket.off(newBurime, onNewBurime);\n    };\n  }, [burimes]);\n  var changeMode = useCallback(function () {\n    return setEdittedBurime(edittedBurime ? undefined : new BurimeModel());\n  }, [edittedBurime]);\n  var onSave = useCallback(function (burime) {\n    socket.emit(createBurime, burime);\n    changeMode();\n  }, [changeMode]);\n  var onReject = useCallback(function (burime) {\n    return socket.emit(deleteBurime, burime);\n  }, []);\n  var onAccept = useCallback(function (burime) {\n    burime.user2 = user;\n    socket.emit(acceptBurime, burime);\n  }, []);\n  return React.createElement(React.Fragment, null, !edittedBurime && React.createElement(Title, null, \"\\u041F\\u0440\\u0438\\u0433\\u043B\\u0430\\u0448\\u0435\\u043D\\u0438\\u044F\"), !(edittedBurime || haveCall) && React.createElement(ButtonWrapper, null, React.createElement(Button, {\n    width: 300,\n    onClick: changeMode\n  }, \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0438\\u0433\\u0440\\u0443\")), !loading ? React.createElement(React.Fragment, null, edittedBurime ? React.createElement(BurimeEdit, {\n    burime: edittedBurime,\n    onSave: onSave,\n    onCancel: changeMode\n  }) : React.createElement(BurimeCallList, {\n    haveCall: haveCall,\n    onAccept: onAccept,\n    onReject: onReject,\n    burimes: burimes\n  })) : React.createElement(Spinner, null));\n};","map":null,"metadata":{},"sourceType":"module"}